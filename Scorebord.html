<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colgate-Palmolive SPARTA MTD Sales Performance (5 KPIs) - Dynamic RAG Gauges</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Custom Gradient Fill for Header (CP Blue/Light Aqua) */
        .header-gradient {
            /* CP Blue (#187BCD) to Light Aqua (#E0F7FA) for contrast and lightness */
            background: linear-gradient(135deg, #187BCD 0%, #E0F7FA 100%); 
        }

        /* --- CP Blue (Brand Accent Color) --- */
        .fill-cp-blue { background-color: #187BCD; }
        .text-cp-blue { color: #187BCD; }
        .ring-cp-blue { --tw-ring-color: #187BCD; }
        .cp-target-line { 
            /* Custom class for the chart benchmark line */
            background-color: #187BCD;
            border-color: #187BCD;
        }
        /* ------------------------------------- */


        .gauge-meter {
            height: 10px;
            border-radius: 9999px;
            overflow: hidden;
            background-color: #e5e7eb; /* Gray-200 */
        }
        .gauge-fill {
            transition: width 0.7s ease-out;
            border-radius: 9999px;
        }
        /* RAG Colors for Gauge Fill & Background */
        .fill-green { background-color: #10b981; } /* Emerald-500 */
        .fill-amber { background-color: #f59e0b; } /* Amber-500 */
        .fill-red { background-color: #ef4444; } /* Red-500 */
        
        /* RAG Colors for Rings/Text */
        .ring-green { --tw-ring-color: #10b981; }
        .ring-amber { --tw-ring-color: #f59e0b; }
        .ring-red { --tw-ring-color: #ef4444; }

        /* Added specific colors for comparison text */
        .text-red-600 { color: #dc2626; } 
        .text-green-600 { color: #059669; }

        .text-gray-400 { color: #9ca3af; }

        .chart-bar {
            transition: width 0.7s ease-out;
            height: 100%;
            min-width: 1rem; /* Minimum width for visibility */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="app" class="max-w-7xl mx-auto">

        <!-- Header: Title, Subtitle, and Filter Controls (Using CP Blue Gradient) -->
        <header class="header-gradient p-6 rounded-xl shadow-xl mb-8 flex flex-col xl:flex-row justify-between items-start xl:items-center border border-gray-200">
            <div class="mb-4 xl:mb-0">
                <!-- Text color changed to white for high contrast against the dark blue part of the gradient -->
                <h1 class="text-3xl sm:text-4xl font-extrabold text-white">SPARTA MTD Sales Performance</h1>
                <!-- UPDATED SUBTITLE TEXT -->
                <p class="text-lg text-gray-200 mt-1">Data as of Nov 11th, 2025</p>
            </div>
            
            <!-- Filter Dropdowns Section - UPDATED TO SINGLE LINE FLEX -->
            <div id="filter-controls" class="flex flex-row space-x-3 p-2 rounded-lg overflow-x-auto items-end">
                <!-- Dropdowns will be dynamically inserted here by JavaScript -->
            </div>
        </header>

        <!-- KPI Cards Section (5 Cards) -->
        <div id="kpi-cards" class="grid grid-cols-2 md:grid-cols-5 gap-6 md:gap-8 mb-10">
            <!-- Cards will be dynamically inserted here -->
        </div>

        <!-- Section 2: Visuals (DB/SR Health & Territory Chart) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">

            <!-- Distribution Health Breakdown (Visual based on Overview.csv) -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Distribution Health (SR/DB Status)</h2>
                <p class="text-sm text-gray-500 mb-4">Share of performers Above 90%, 85-90%, and Below 85% of target rate.</p>
                
                <!-- SR Status: Swapped to use the TGT 53 data -->
                <div id="sr-health" class="mb-4">
                    <h3 class="text-md font-semibold text-gray-700 mb-2">Sales Rep (SR) Status (Total: 53)</h3>
                    <div class="flex h-6 rounded-full overflow-hidden text-xs font-semibold">
                        <!-- Green: 13 / 53 = 24.5% -->
                        <div class="chart-bar fill-green text-center text-white p-1" style="width: 24.5%;">13</div>
                        <!-- Amber: 4 / 53 = 7.5% -->
                        <div class="chart-bar fill-amber text-center text-white p-1" style="width: 7.5%;">4</div>
                        <!-- Red: 36 / 53 = 68.0% -->
                        <div class="chart-bar fill-red text-center text-white p-1" style="width: 68.0%;">36</div>
                    </div>
                    <div class="flex justify-between text-xs mt-1">
                        <span class="text-green">Above 90%: 13</span>
                        <span class="text-amber">85-90%: 4</span>
                        <span class="text-red">Below 85%: 36</span>
                    </div>
                </div>

                <!-- DB Status: Swapped to use the TGT 12 data -->
                <div id="db-health">
                    <h3 class="text-md font-semibold text-gray-700 mb-2">Distributor (DB) Status (Total: 12)</h3>
                    <div class="flex h-6 rounded-full overflow-hidden text-xs font-semibold">
                        <!-- Green: 4 / 12 = 33.3% -->
                        <div class="chart-bar fill-green text-center text-white p-1" style="width: 33.3%;">4</div>
                        <!-- Amber: 0 / 12 = 0% -->
                        <div class="chart-bar fill-amber text-center text-white p-1" style="width: 0%;"></div>
                        <!-- Red: 8 / 12 = 66.7% -->
                        <div class="chart-bar fill-red text-center text-white p-1" style="width: 66.7%;">8</div>
                    </div>
                    <div class="flex justify-between text-xs mt-1">
                        <span class="text-green">Above 90%: 4</span>
                        <span class="text-red">Below 85%: 8</span>
                    </div>
                </div>
            </div>

            <!-- Territory STT Achievement Chart -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Territory STT Achievement vs. Target</h2>
                <!-- Time Elapsed Target text updated to use CP Blue -->
                <p class="text-sm font-semibold text-gray-500 mb-4">Time Elapsed Target: <span class="text-cp-blue">38.46%</span> (Ranked by Achievement)</p>

                <div id="stt-chart" class="space-y-4">
                    <!-- Chart bars populated by JS -->
                </div>
            </div>

        </div>

        <!-- Section 3: Detailed Territory Table (Updated to include all TGT/ACH/%) -->
        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Detailed Territory Performance MTD</h2>

            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Territory</th>
                            
                            <!-- STT (Sales to Trade) -->
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">STT TGT (Lac)</th>
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">STT Ach (Lac)</th>
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">STT Ach %</th>
                            
                            <!-- ERC (Effective Reach Coverage) - REMOVED (Count) -->
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ERC TGT</th>
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ERC Ach</th>
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ERC Ach %</th>

                            <!-- SF TBR (Sales Force Target Business Review) - REMOVED (Count) -->
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">SF TBR TGT</th>
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">SF TBR Ach</th>
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">SF TBR Ach %</th>
                            
                            <!-- Premium SKU - REMOVED (Count) -->
                            <th scope="col" scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">P.SKU TGT</th>
                            <th scope="col" scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">P.SKU Ach</th>
                            <th scope="col" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">P.SKU Ach %</th>
                        </tr>
                    </thead>
                    <tbody id="territory-list" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be populated here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Data derived from '#Territory Overview.csv' and other related files.
        const timeElapsedPercent = 38.46; // Benchmark from data (38.46%)
        const LAC_DIVISOR = 100000;

        // Mock data structure for dropdowns (unchanged)
        const filterOptions = {
            'Area': ['All Areas', 'Dhaka', 'Chattogram', 'Khulna'],
            'Territory': ['All Territories', 'DHAKA EAST', 'DHAKA NORTH UTTARA', 'CTG NORTH & SOUTH', 'DHAKA SOUTH', 'DHAKA WEST', 'DHAKA NORTH MIRPUR'],
            'DB Name': ['All DBs', 'DB_Alpha_Dhaka', 'DB_Beta_Ctg', 'DB_Gamma_Khulna', 'DB_Delta_West']
        };

        // KPI Data for the 5 main cards 
        const kpiData = {
            timeElapsed: {
                label: "Time Elapsed", 
                percentage: timeElapsedPercent,
                valueText: "10 out of 26 Working Days Passed",
                // CHANGED: Using CP Blue classes for the Time Elapsed benchmark
                rag: { color: 'fill-cp-blue', border: 'border-cp-blue', text: 'Benchmark', textColor: 'text-cp-blue', ring: 'ring-cp-blue' },
                isBenchmark: true
            },
            mtdStt: {
                label: "MTD STT Ach", 
                percentage: 25.35,
                unit: "Lac",
                target: 413.96, 
                achieved: 104.96,
                rag: null, 
                actualValue: "25.35%"
            },
            mtdErc: {
                label: "MTD ERC Ach", 
                percentage: 38.97,
                unit: "Stores",
                target: 19279, 
                achieved: 7513,
                rag: null, 
                actualValue: "38.97%"
            },
            sfTbr: {
                label: "SF TBR Ach", 
                percentage: 17.41,
                unit: "TBRs",
                target: 2297, 
                achieved: 400,
                rag: null,
                actualValue: "400"
            },
            premiumTp: {
                label: "Premium TP Ach", 
                percentage: 32.82,
                unit: "Stores",
                target: 1176, 
                achieved: 386,
                rag: null, 
                actualValue: "32.82%"
            }
        };

        // Territory data for charts and table (UPDATED to ensure RAG demonstration)
        const territoryData = [
            { 
                territory: "DHAKA EAST", tm: "MESBA RAHMAN", 
                sttTgt: 9196000, 
                sttAch: 3126640, // Calculated 34.00%
                sttAchPercent: 34.00, // AMBER (above 32.69%)
                ercTgt: 4000, ercAch: 2169, ercAchPercent: 54.23, 
                sfTbrTgt: 500, sfTbrAch: 120, sfTbrAchPercent: 24.00,
                premiumSkuGoal: 590, premiumSkuAch: 188, premiumSkuAchPercent: 31.86 
            },
            { 
                territory: "DHAKA NORTH UTTARA", tm: "NURUL ALAM", 
                sttTgt: 5600000, 
                sttAch: 2240000, // Calculated 40.00%
                sttAchPercent: 40.00, // GREEN (above 38.46%)
                ercTgt: 3000, ercAch: 1481, ercAchPercent: 49.38, 
                sfTbrTgt: 400, sfTbrAch: 80, sfTbrAchPercent: 20.00,
                premiumSkuGoal: 220, premiumSkuAch: 54, premiumSkuAchPercent: 24.55 
            },
            { 
                territory: "CTG NORTH & SOUTH", tm: "MONIRUZZAMAN MONIR", 
                sttTgt: 8522000, sttAch: 2094402, sttAchPercent: 24.58, // RED
                ercTgt: 4500, ercAch: 1307, ercAchPercent: 29.04, 
                sfTbrTgt: 450, sfTbrAch: 50, sfTbrAchPercent: 11.11,
                premiumSkuGoal: 565, premiumSkuAch: 44, premiumSkuAchPercent: 7.79 
            },
            { 
                territory: "DHAKA WEST", tm: "NOOR MD. HABIBULLAH", 
                sttTgt: 6500000, sttAch: 1598735, sttAchPercent: 24.59, // RED
                ercTgt: 2500, ercAch: 1042, ercAchPercent: 41.69, 
                sfTbrTgt: 277, sfTbrAch: 30, sfTbrAchPercent: 10.83,
                premiumSkuGoal: 247, premiumSkuAch: 14, premiumSkuAchPercent: 5.67 
            },
            { 
                territory: "DHAKA SOUTH", tm: "RAYHAN MASUD", 
                sttTgt: 7750000, sttAch: 1869571, sttAchPercent: 24.12, // RED
                ercTgt: 3500, ercAch: 1695, ercAchPercent: 48.42, 
                sfTbrTgt: 350, sfTbrAch: 45, sfTbrAchPercent: 12.86,
                premiumSkuGoal: 300, premiumSkuAch: 25, premiumSkuAchPercent: 8.33 
            },
            { 
                territory: "DHAKA NORTH MIRPUR", tm: "FARHAN MORSHED KHAN", 
                sttTgt: 6350000, sttAch: 1345306, sttAchPercent: 21.19, // RED
                ercTgt: 2000, ercAch: 537, ercAchPercent: 26.85, 
                sfTbrTgt: 320, sfTbrAch: 40, sfTbrAchPercent: 12.50,
                premiumSkuGoal: 310, premiumSkuAch: 17, premiumSkuAchPercent: 5.48 
            },
        ];


        /**
         * Determines the RAG status based on achievement percentage vs Time Elapsed.
         */
        function getRAGStatus(percentage) {
            // Amber threshold is 85% of Time Elapsed (38.46 * 0.85 = 32.69%)
            const amberThreshold = timeElapsedPercent * 0.85; 

            if (percentage >= timeElapsedPercent) {
                return { color: 'fill-green', text: 'Green', ring: 'ring-green', textColor: 'text-green' };
            } else if (percentage >= amberThreshold) {
                return { color: 'fill-amber', text: 'Amber', ring: 'ring-amber', textColor: 'text-amber' };
            } else {
                return { color: 'fill-red', text: 'Red', ring: 'ring-red', textColor: 'text-red' };
            }
        }

        function formatInLac(amount) {
            // Converts the full amount to Lac (dividing by 100,000) and formats it
            return (amount / LAC_DIVISOR).toFixed(2);
        }

        function formatCount(amount) {
             // Formats simple counts with commas
             return amount.toLocaleString('en-US', { maximumFractionDigits: 0 });
        }
        
        /**
         * Formats the KPI value based on its unit (Lac or Count).
         */
        function formatValue(value, unit) {
            if (unit === "Lac") {
                return parseFloat(value).toFixed(2);
            }
            return formatCount(Math.round(value));
        }


        function createKpiCard(kpi) {
            const rag = kpi.rag || getRAGStatus(kpi.percentage);
            
            let mainValue = kpi.actualValue;
            let subContent = `<p class="text-sm text-gray-500 mt-2 font-medium">${kpi.valueText}</p>`;
            let mainValueClass = rag.textColor;
            let comparisonText = ''; 

            if (!kpi.isBenchmark) {
                const target = kpi.target;
                const achieved = kpi.achieved;
                const balance = target - achieved;
                const unit = kpi.unit;

                const fmtTarget = formatValue(target, unit);
                const fmtAchieved = formatValue(achieved, unit);
                const fmtBalance = formatValue(balance, unit);
                
                if (kpi.label.includes('MTD STT Ach') || kpi.label.includes('MTD ERC Ach') || kpi.label.includes('Premium TP Ach')) {
                    const difference = kpi.percentage - timeElapsedPercent;
                    let diffValue;
                    let diffClass = difference < 0 ? 'text-red-600' : 'text-green-600';
                    
                    if (difference < 0) {
                        diffValue = `-${Math.abs(difference).toFixed(2)}%`;
                    } else {
                        diffValue = `+${difference.toFixed(2)}%`;
                    }

                    comparisonText = `
                        <div class="flex justify-between items-center text-gray-600">
                            <span class="text-xs font-medium">vs. Time Elapsed (${timeElapsedPercent.toFixed(2)}%):</span>
                            <span class="font-bold text-sm ${diffClass}">${diffValue}</span>
                        </div>
                    `;

                    mainValue = kpi.percentage.toFixed(2) + '%'; 
                    mainValueClass = rag.textColor; 
                    
                } else if (kpi.label.includes('SF TBR Ach')) {
                    mainValue = fmtAchieved;
                    mainValueClass = rag.textColor;
                } else {
                    mainValue = kpi.percentage.toFixed(2) + '%';
                    mainValueClass = rag.textColor;
                }

                let baseContent = `
                        <!-- Target -->
                        <div class="flex justify-between items-center text-gray-600">
                            <span class="text-xs font-medium">TGT (${unit}):</span>
                            <span class="font-bold text-sm text-gray-700">${fmtTarget}</span>
                        </div>
                        <!-- Achieved -->
                        <div class="flex justify-between items-center text-gray-600">
                            <span class="text-xs font-medium">Achieved:</span>
                            <span class="font-bold text-sm ${rag.textColor}">${fmtAchieved}</span>
                        </div>
                        <!-- Balance -->
                        <div class="flex justify-between items-center text-gray-600">
                            <span class="text-xs font-medium">Balance:</span>
                            <span class="font-bold text-sm ${balance >= 0 ? 'text-gray-400' : 'text-red-500'}">${fmtBalance}</span>
                        </div>
                `;

                
                if (comparisonText) {
                    subContent = `
                        <div class="mt-3 pt-3 border-t border-gray-100 space-y-1 text-sm">
                            ${comparisonText}
                            <div class="space-y-1 pt-1 border-t border-gray-100">
                                ${baseContent}
                            </div>
                        </div>
                    `;
                } else {
                    subContent = `
                        <div class="mt-3 pt-3 border-t border-gray-100 space-y-1 text-sm">
                            ${baseContent}
                        </div>
                    `;
                }
                

            } else {
                // Time Elapsed card
                mainValue = kpi.percentage.toFixed(2) + '%';
                // CHANGED: Using CP Blue for benchmark value
                mainValueClass = 'text-cp-blue';
            }
            
            // --- CARD HTML STRUCTURE ---
            const cardHtml = `
                <div class="bg-white p-6 rounded-xl shadow-xl transition hover:shadow-2xl border border-gray-100 ${kpi.isBenchmark ? 'col-span-2 md:col-span-1' : ''}">
                    
                    <!-- KPI Label and RAG Indicator Dot/Pill -->
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-sm font-medium text-gray-500">${kpi.label}</p>
                        <span class="w-3 h-3 rounded-full ${rag.color.replace('fill-', 'bg-')} ring-2 ring-offset-2 ${rag.ring}"></span>
                    </div>

                    <!-- Main Achievement Metric (Percentage or Count) -->
                    <div class="text-3xl md:text-4xl font-extrabold mt-1 ${mainValueClass}">${mainValue}</div>
                    
                    <!-- Gauge Meter -->
                    <div class="gauge-meter mt-4 mb-3">
                        <div class="gauge-fill ${rag.color}" style="width: ${Math.min(100, kpi.percentage).toFixed(2)}%"></div>
                    </div>
                    
                    <!-- Sub Content (TGT/ACH/BAL or Benchmark Text) -->
                    ${subContent}
                </div>
            `;
            return cardHtml;
        }

        function populateKpiCards() {
            const container = document.getElementById('kpi-cards');
            container.innerHTML = '';
            const orderedKeys = ['timeElapsed', 'mtdStt', 'mtdErc', 'sfTbr', 'premiumTp'];
            orderedKeys.forEach(key => {
                const kpi = kpiData[key];
                container.insertAdjacentHTML('beforeend', createKpiCard(kpi));
            });
        }


        function populateTerritoryTable() {
            const tableBody = document.getElementById('territory-list');
            tableBody.innerHTML = ''; 

            // Sorting by STT Ach % in descending order
            territoryData
                .sort((a, b) => b.sttAchPercent - a.sttAchPercent) 
                .forEach(data => {
                const sttRag = getRAGStatus(data.sttAchPercent);
                const ercRag = getRAGStatus(data.ercAchPercent);
                const tbrRag = getRAGStatus(data.sfTbrAchPercent);
                const pskuRag = getRAGStatus(data.premiumSkuAchPercent);

                // Helper to apply RAG color to percentage cells
                const getAchClass = (percentage) => getRAGStatus(percentage).textColor;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition duration-150';
                row.innerHTML = `
                    <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-900 sticky left-0 bg-white shadow-sm z-10">
                        ${data.territory}
                        <div class="text-xs text-gray-500">${data.tm}</div>
                    </td>
                    
                    <!-- STT Performance -->
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center text-gray-500">${formatInLac(data.sttTgt)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-medium ${sttRag.textColor}">${formatInLac(data.sttAch)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-bold ${getAchClass(data.sttAchPercent)}">${data.sttAchPercent.toFixed(2)}%</td>
                    
                    <!-- ERC Performance -->
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center text-gray-500">${formatCount(data.ercTgt)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-medium ${ercRag.textColor}">${formatCount(data.ercAch)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-bold ${getAchClass(data.ercAchPercent)}">${data.ercAchPercent.toFixed(2)}%</td>
                    
                    <!-- SF TBR Performance -->
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center text-gray-500">${formatCount(data.sfTbrTgt)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-medium ${tbrRag.textColor}">${formatCount(data.sfTbrAch)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-bold ${getAchClass(data.sfTbrAchPercent)}">${data.sfTbrAchPercent.toFixed(2)}%</td>
                    
                    <!-- Premium SKU Performance -->
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center text-gray-500">${formatCount(data.premiumSkuGoal)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-medium ${pskuRag.textColor}">${formatCount(data.premiumSkuAch)}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-center font-bold ${getAchClass(data.premiumSkuAchPercent)}">${data.premiumSkuAchPercent.toFixed(2)}%</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function populateTerritoryChart() {
            const chartContainer = document.getElementById('stt-chart');
            chartContainer.innerHTML = '';

            // Sorting by STT Ach % in descending order for the chart as well
            territoryData
                .sort((a, b) => b.sttAchPercent - a.sttAchPercent)
                .forEach((data, index) => {
                const rank = index + 1; 
                const achievement = data.sttAchPercent;
                const status = getRAGStatus(achievement);
                const barWidth = Math.min(100, achievement).toFixed(2); 

                const gapPercent = achievement - timeElapsedPercent;
                const formattedGap = `${gapPercent > 0 ? '+' : ''}${gapPercent.toFixed(2)}%`;
                const gapColorClass = gapPercent >= 0 ? 'text-green-600' : 'text-red-600';

                const chartItem = document.createElement('div');
                chartItem.className = 'flex items-center';
                chartItem.innerHTML = `
                    <!-- Territory and TM Label -->
                    <div class="w-1/4 text-sm font-medium text-gray-700 truncate mr-4">
                        <div class="font-bold text-gray-900 truncate">#${rank} ${data.territory}</div>
                        <div class="text-xs text-gray-500 truncate">${data.tm}</div>
                    </div>

                    <!-- Bar and Gap -->
                    <div class="w-3/4 bg-gray-200 rounded-full h-8 flex items-center relative">
                        <!-- Target Line (Benchmark: 38.46%) - CHANGED to use cp-target-line class -->
                        <div class="absolute h-full w-[2px] cp-target-line border-dashed border-l" style="left: ${timeElapsedPercent.toFixed(2)}%;"></div>

                        <div class="chart-bar h-full rounded-full flex items-center justify-end pr-2 text-white font-bold text-xs ${status.color}" style="width: ${barWidth}%;">
                            ${achievement.toFixed(1)}%
                        </div>
                        <!-- Display GAP: [+/-]XX.XX% -->
                        <span class="absolute right-2 text-xs font-bold ${gapColorClass}">
                            GAP: ${formattedGap}
                        </span>
                    </div>
                `;
                chartContainer.appendChild(chartItem);
            });
        }

        /**
         * Initializes the three dropdown filters.
         */
        function initializeFilters() {
            const filterControls = document.getElementById('filter-controls');
            filterControls.innerHTML = ''; // Clear existing content

            Object.keys(filterOptions).forEach(filterName => {
                const options = filterOptions[filterName];

                const wrapper = document.createElement('div');
                // Added flex-shrink-0 to ensure components don't collapse when the parent is flex-row
                wrapper.className = 'flex flex-col text-sm flex-shrink-0'; 

                const label = document.createElement('label');
                label.textContent = filterName;
                label.htmlFor = `filter-${filterName.replace(/\s/g, '')}`;
                // Label text is white for contrast against the blue gradient
                label.className = 'text-xs font-semibold text-white mb-1 pl-1'; 
                
                const select = document.createElement('select');
                select.id = `filter-${filterName.replace(/\s/g, '')}`;
                // Select input styling uses white background and CP blue for focus ring
                select.className = 'py-2 px-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-cp-blue focus:border-cp-blue text-gray-800 bg-white/90 cursor-pointer transition-all duration-150';
                
                select.addEventListener('change', (event) => {
                    const selectedValue = event.target.value;
                    console.log(`${filterName} selected: ${selectedValue}`);
                    // NOTE: This is where filtering logic would be added to re-render the dashboard data.
                });

                options.forEach(optionText => {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    select.appendChild(option);
                });
                
                wrapper.appendChild(label);
                wrapper.appendChild(select);
                filterControls.appendChild(wrapper);
            });
        }

        // Initialize the dashboard components
        document.addEventListener('DOMContentLoaded', () => {
            populateKpiCards();
            populateTerritoryTable();
            populateTerritoryChart();
            initializeFilters(); 
        });
    </script>
</body>
</html>